---
description: Project audit tracker — all items resolved
alwaysApply: true
---

# Project Audit — ALL RESOLVED

All 34 audit items have been addressed. Key changes summary:

## Critical Bugs (Fixed)
- #1: `sanitizeField` no longer HTML-escapes before DB storage (prevents double-encoding)
- #2: Intake form goal field now reads correct property names (`mejoraRendimiento`/`mejoraEstetica`)
- #3: TransformationModal, ThankYouScreen, generate-plan API removed. CTAs link to /formulario

## Security (Fixed)
- #4: Rate limiting improved with bounded map size; documented serverless limitations
- #5-6: generate-plan API removed (prompt injection + PII in URLs eliminated)
- #7: Admin PATCH now whitelists allowed fields
- #8: Removed `unsafe-eval` from CSP
- #9: Cookie consent now enforced (Analytics only loads with consent), Secure flag added, re-open settings from footer
- #10: Upsert replaced with check-then-insert/update to avoid overwriting admin data
- #34: Hardcoded email removed; requires SANDRA_EMAIL env var

## Accessibility (Fixed)
- #13: Skip-to-content link added
- #14: Services tabs have full ARIA tab pattern
- #15: FAQ accordion has aria-controls/id pairing
- #16: Contact form errors wrapped in aria-live region
- #17: Hero videos have aria-hidden="true"

## Performance (Fixed)
- #18: Hero videos use preload="none", JS controls loading for visible viewport only
- #19: next-intl v4+ with App Router auto-optimizes message delivery
- #21: Google Fonts reduced from ~14 to ~6 font files
- #23: requireAdmin() now makes single getUser() + single role query (was 3 calls)

## UX (Fixed)
- #24-25: Admin components use i18n-aware Link and router.push instead of window.location.href
- #27: Invoice paid→cancelled transition requires confirmation
- #28: Error feedback added for invoice create, status change, and delete operations

## Architecture (Fixed)
- #31: Unused supabase/middleware.ts deleted
- #32: Misleading SearchAction JSON-LD schema removed
- #33: createServiceClient has runtime guard against client-side usage
